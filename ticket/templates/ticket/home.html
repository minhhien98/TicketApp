{% extends "ticket/base.html" %}
{% load i18n %}
{% load static %}
{% block content %}
<body style="background-image: url('/static/images/hero_1.png');">
    <div class="container" style="margin-top: 150px;">
        <div class="table-responsive">
            <form id="RegisterForm" method="POST" action="{% url 'ticket:home' %}" onsubmit="SubmitLoader()">
                {% csrf_token %}
                <table class="table table-light table-responsive" style="border-radius: 6px; overflow: hidden;">
                    <thead>
                        <tr>
                            <th></th>
                            <th>WORKSHOP</th>
                            <th>{% trans 'ĐĂNG KÝ' %}</th>
                            <th>{% trans 'ĐÃ CHỌN' %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for workshop in workshops %}
                        <input type="text" name="id" value="{{ workshop.id }}" readonly hidden>
                        <tr>
                            <td>
                                <img class="img-fluid" src="" alt="" style="height: 90px; width:90px;">
                            </td>
                            <td>
                                {% if workshop.intro_link %}
                                <a href="{{ workshop.intro_link }}" target="_blank">{{ workshop.name }}</a>
                                {% else %}
                                {{ workshop.name }}
                                {% endif %}
                            </td>
                            <td>           
                                <input class="form-control" type="number" name='quantity' value="0" min="0" style="text-align: center; width: 70px;">
                            </td>
                            <td>{{ workshop.registered }}</td>
                        </tr>                       
                        {% endfor %}    
                        <tr>
                            <td colspan="4" class="text-center">
                                <div class="d-flex justify-content-center">
                                    <button class="btn btn-danger" id="RegisterButton" type="button" data-bs-toggle="modal" data-bs-target="#ConfirmModal">
                                        <span class="spinner-border spinner-border-sm" id="RegisterSpinner" role="status" aria-hidden="true" hidden></span>
                                        {% trans 'Đăng ký' %}
                                    </button>
                                    <a href="{% url 'ticket:guide' %}" class="btn btn-info" style="margin-left: 10px;">{% trans 'Hướng dẫn mua vé thường' %}</a>
                                </div>                            
                            </td>
                        </tr>            
                    </tbody>
                </table>
        
                <div class="modal fade" id="ConfirmModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header text-center border-0">
                                <h5 class="modal-title w-100">{% trans 'Đăng ký Workshop' %}</h5>
                            </div>
                            <div class="modal-body text-center">
                                {% trans 'Bạn có muốn đăng ký workshop đã chọn không?' %}
                            </div>
                            <div class="modal-footer justify-content-center border-0">
                                <button class="btn btn-danger" type="submit" data-bs-dismiss="modal">{% trans 'Đăng ký' %}</button>
                                <button class="btn btn-primary" type="button" data-bs-dismiss="modal">{% trans 'Hủy' %}</button>
                            </div>
                        </div>
                    </div>
                </div>           
            </form>
        </div>      
    </div>
    
    <div class="toast-container text-center top-0 start-50 translate-middle-x" style="margin-top: 110px;">
        {% if messages %}
            {% for message in messages %}
            {% if message.tags == 'success'%}
            <div id="MessageToast" class="toast align-items-center text-white bg-success w-100 border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="4000">
                <div class="d-flex">
                    <div class="toast-body">
                        {{ message }}
                    </div>
                </div>
            </div>
            {% elif message.tags == 'info'%}
            <div id="MessageToast" class="toast align-items-center text-white bg-primary w-100 border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="4000">
                <div class="d-flex">
                    <div class="toast-body">
                        {{ message }}
                    </div>
                </div>
            </div>
            {% elif message.tags == 'warning'%}
            <div id="MessageToast" class="toast align-items-center text-white bg-warning w-100 border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="4000">
                <div class="d-flex">
                    <div class="toast-body">
                        {{ message }}
                    </div>
                </div>
            </div>
            {% elif message.tags == 'error'%}
            <div id="MessageToast" class="toast align-items-center text-white bg-danger w-100 border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="4000">
                <div class="d-flex">
                    <div class="toast-body">
                        {{ message }}
                    </div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
            {% endif %}
    </div>
</body>




<script>
    $(document).ready(function(){
        $("#MessageToast").toast('show');       
    });

    $('#RegisterForm').submit(function (e) {
        e.preventDefault();
        $('#RegisterButton').prop('disabled', true);
        $('#RegisterSpinner').prop('hidden', false);
        //Submit    
        setTimeout(function () {
            $('#RegisterForm')[0].submit();
        }, 1000);
    });
</script>
{% endblock %}